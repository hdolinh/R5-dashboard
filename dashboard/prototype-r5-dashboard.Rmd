---
title: "R5 Rec-Shed Dashboard"
output: 
  flexdashboard::flex_dashboard:
    vertical-layout: fill
    theme:
      primary: "#217a38"
      secondary: "#24583b"
      success: "#96d4ac"
      info: "#2f5b75"
      warning: "#ffc734"
      danger: "#892f31"
      base_font:
        google: Nunito
      code_font:
        google: Fira Code
      heading_font:
        google: Nunito
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(mapview)
library(here)
library(sf)
library(vroom)
library(dplyr)
library(tidyr)
library(leaflet)
library(ggplot2)
library(scales)
library(tigris)
library(RColorBrewer)
library(zipcodeR)
library(shiny)
library(ggiraph)
library(janitor)
library(tidycensus)
library(stringr)
library(plotly)
# bslib::bs_themer()
```

```{r read in data}
# spatial 
r5_au_bounds <- sf::read_sf(here::here("data/spatial/clean/"))

# ridb
usfs_ridb2021 <- vroom::vroom(here::here("data/ridb/clean/usfs_ridb2021_no_dist_travel.csv"))

# Inyo National Forest subset
inyo_usfs_ridb2021 <- usfs_ridb2021 %>% 
  dplyr::filter(forestname == "Inyo National Forest")
```

## Sidebar {.sidebar}

```{r}
shiny::selectInput("forest", label = "Select a forest:",
                   choices = sort(unique(usfs_ridb2021$forestname)),
                   selected = "Inyo National Forest")
```

## Column 1

### R5 Map

```{r}
# mapview::mapview(r5_au_bounds)

# create subset of park info
park_sub_sf <- usfs_ridb2021 %>% 
  dplyr::group_by(forestname,
                  park,
                  sitetype,
                  facilityzip,
                  facilitylongitude,
                  facilitylatitude) %>%
  dplyr::summarize(n = n()) %>%
  # filter(is.na(sitetype) == TRUE)
  dplyr::select(!n) %>%
  # create as sf object with 4326 crs
  st_as_sf(
    coords = c("facilitylongitude", "facilitylatitude"),
    crs = 4326,
    remove = FALSE
  )

# transform to 4326 crs
r5_bounds <- r5_au_bounds %>% sf::st_as_sf(crs = 4326)

reactive_r5_bounds <- shiny::reactive({
  r5_bounds %>%
    filter(forestname == input$forest)
})

reactive_park <- shiny::reactive({
  park_sub_sf %>% 
    filter(forestname == input$forest)
})

leaflet::renderLeaflet({
  
  camping_icon <- makeIcon(
    here("images/camping_location_icon.png"),
    iconWidth = 25,
    iconHeight = 25
  )
  
  leaflet() %>%
    addPolygons(
      data = reactive_r5_bounds(),
      weight = 1,
      popup = paste0(reactive_r5_bounds()$forestname)
    ) %>%
    addMarkers(
      lng = reactive_park()$facilitylongitude,
      lat = reactive_park()$facilitylatitude,
      popup = paste0(reactive_park()$park,
                     "<br>",
                     "Type of site: ",
                     reactive_park()$sitetype),
      icon = camping_icon
    ) %>% 
    addProviderTiles(providers$CartoDB.Voyager)
})
```


## Column 2
 
### US Visitorshed Map

```{r}

```

### Visitor Data

```{r}

```


